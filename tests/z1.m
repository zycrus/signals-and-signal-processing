clc
clear

% % Sampling frequency
f = 225;
fs = 44100;
syms t z;
% % Define the filter coefficients for B(z) and A(z)
[B, A] = butter (4, [800 2000]/(fs/2), "bandpass");
yt = sin(2*pi*f*t/fs);
yz = ztrans(yt, t, z);
% 
numerator = poly2sym(B, z);
denominator = poly2sym(A, z);  % A(e^(jω))

% 
fz = numerator/denominator;
% % 
c = yz * fz;
% % 
omega = 2 * pi * f/fs;
z = exp(1j * omega); % z = e^(jω)

n1 = ["0.000000973*z^8" "0.000000000" "-0.000003890*z^6" "0.000000000" "0.000005835*z^4" "0.000000000" "-0.000003890*z^2" "0.000000000" "0.000000973"];
d = ["z^8"   "-7.830487565*z^7"   "26.829540266*z^6"  "-52.536072863*z^5"   "64.304356316*z^4"  "-50.380436720*z^3"   "24.673035777*z^2"   "-6.905650982*z"    "0.845715772"];
d2 = ["z^8"   "-7.830487565*z^7"   "26.82957511*z^6"  "-52.53617588*z^5"   "64.3045249*z^4"  "-50.38060222*z^3"   "24.67313316*z^2"   "-6.905682905*z"    "0.8457202522"];

n2 = ["(2296319486903667*z^8)/2361183241434822606848" "0" "-(2296319486903667*z^6)/590295810358705651712" "0" "(6888958460711001*z^4)/1180591620717411303424" "0" "-(2296319486903667*z^2)/590295810358705651712" "0" "2296319486903667/2361183241434822606848"];
d3 = ["z^8" "-(8816345220089487*z^7)/1125899906842624" "(7551844221465587*z^6)/281474976710656" "-(3696897471375553*z^5)/70368744177664" "(4525016799086605*z^4)/70368744177664" "-(3545208063079931*z^3)/70368744177664" "(6944842170582635*z^2)/281474976710656" "-(3887535898794285*z)/562949953421312" "3808765234178705/4503599627370496"];

dd = 0;
nn = 0;

d_arr = [];
n_arr = [];

for n = 1:9
    e = eval(d3(n))
    e2 = eval(n2(n));
    dd = dd+e;
    nn = nn+e2;
    d_arr(n) = e;
    n_arr(n) = e2;
end
display(mat2str(n_arr));
display(mat2str(d_arr));
disp(nn);
disp(dd);
disp(abs(nn/dd));
% disp(eval(denominator));


% p1 = eval("(z^8)");
% p2 = eval("- ((8816345220089487*z^7)/1125899906842624)");
% p3 = eval("((7551844221465587*z^6)/281474976710656)");
% p4 = eval("-((3696897471375553*z^5)/70368744177664)");
% p5 = eval("((4525016799086605*z^4)/70368744177664)");
% p6 = eval("- ((3545208063079931*z^3)/70368744177664)");
% p7 = eval("((6944842170582635*z^2)/281474976710656)");
% p8 = eval("-((3887535898794285*z)/562949953421312)");
% p9 = eval("(3808765234178705/4503599627370496)");
% 
% pt = p1 + p2 + p3 + p4 + p5 + p6 + p7 + p8 + p9;

% fprintf("%0.20f + j%0.20f\n ", real(p9), imag(p9))


fr = eval(fz)
yr = eval(yz);
fe = abs(fr);
ye = 22050;
% 
% % t = 0:1/fs:1;
% % yt = sin(2*pi*225*t) + sin(2*pi*1000*t) + sin(2*pi*60*t) + sin(2*pi*10*t);
% % plot(abs(fftshift(fft(yt)))/fs);
% 
% 
convo = ye*fe;
% % % 
 fprintf('Frequency:  %0.2fHz, Fs: %0.2fHz\n', f, fs);
 fprintf('Frequency Response (Filter):  %f\n', fe);
 fprintf('Frequency Response (Signal):  %f\n', ye);
 fprintf('Frequency Response (Convolution):  %f\n', convo);
